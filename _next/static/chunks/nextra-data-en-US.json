{"/for_konsumenter":{"title":"For konsumenter","data":{"oppsett#Oppsett":"For √• ta i bruk dp-iverksett m√• klient-applikasjonen √•pne for trafikk til tjenesten. Legg inn f√∏lgende kodesnutt i deres\nnais-konfig:\naccessPolicy:\n  outbound:\n    rules:\n      - application: dp-iverksett\n        namespace: teamdagpenger\nTilsvarende m√• vi √•pne for trafikk fra deres klient-applikasjon i dp-iverksett. Opprett en pull request i dp-iverksett med f√∏lgende kodesnutt i nais-konfig:\naccessPolicy:\n  inbound:\n    rules:\n      - application: [applikasjonsnavn]\n        namespace: [namespace]\nMerk at disse reglene legger opp til service-til-service-kommunikasjon innenfor samme kubernetes-cluster. Det vil si at\nklient-applikasjonen m√• bruke dp-iverksett sin service discovery-url. Bruk en av f√∏lgende URL-er:\nhttp://dp-iverksett.teamdagpenger\nhttp://dp-iverksett.teamdagpenger.svc.cluster.local\nTa kontakt med oss dersom deres klient-applikasjon m√• bruke ingressen for √• kommunisere med dp-iverksett.","autentisering#Autentisering":"Tjenesten krever Azure token p√• alle kall, dvs. enten et Client Credentials-token eller et On-Behalf-Of-token.\nLes mer om autentisering i nais-dokumentasjonen.","api-dokumentasjon-og-kontrakter-for-dto-klasser#API-dokumentasjon og kontrakter for DTO-klasser":"dp-iverksett har swagger-dokumentasjon her.Vi har samlet alle DTO-ene som brukes av API-et i et bibliotek. Se dp-kontrakter p√• github\nog bruk pakken iverksett."}},"/for_konsumenter/avstemming":{"title":"Avstemming","data":{"":"Utbetalingstjenesten h√•ndterer grensesnittavstemming mot √òkonomisystemet internt. Konsumenter trenger ikke √• foreta seg noe for at grensesnittavstemming skal\nsettes i gang og g√• jevnlig.Ta kontakt med oss dersom dere har behov for annen type avstemming mot √òkonomisystemet eller mellom vedtaksl√∏sningen og utbetalingsl√∏sningen."}},"/for_konsumenter/iverksetting":{"title":"Iverksetting","data":{"post-apiiverksetting#POST /api/iverksetting":"Sender en utbetaling til NAVs √∏konomisystem. N√•r API-et mottar en utbetaling som skal iverksettes, gj√∏r den noen enkle valideringer\nog svarer med en 202 Accepted dersom valideringene g√•r gjennom. Resten av l√∏ypa for √• utbetale er helt asynkron og orkestreres\ninternt i dp-iverksett. En ok-respons fra API-et betyr alts√• ikke at utbetalingen er kvittert ok i √∏konomisystemet, men at\ndp-iverksett tar ansvaret for videre h√•ndtering. Bruk status-endepunktet for √• sjekke status p√• utbetalingen.F√∏lgende m√• v√¶re oppfylt for at dp-iverksett skal akseptere utbetalingen:Format p√• utbetaling\nUtbetalingsperiodene m√• ikke overlappe i tid\nUtbetalingsperiodene m√• v√¶re gyldige perioder, dvs. at fom-dato p√• en periode m√• v√¶re f√∏r tom-dato.\nAlle bel√∏p m√• v√¶re positive heltall. Dvs. alle bel√∏p m√• v√¶re hele kroner, og tjenesten aksepterer ikke 0-utbetalinger eller negative utbetalinger\nAlle bel√∏p m√• v√¶re under maksgrensen p√• 5000 kr/dag\nTilstand\ndp-iverksett kan ikke allerede ha en utbetaling med samme behandlingsid\nEvt. tidligere utbetaling m√• tilh√∏re samme sak og person\nEvt. tidligere utbetaling p√• saken m√• v√¶re ferdig iverksatt\nVidere er det noen ytelsesspesifikke valideringer. Ta kontakt med oss dersom din ytelse har spesielle behov.","utbetalinger#Utbetalinger":"Listen av utbetalinger som dp-iverksett tar i mot f√∏lger dette formatet:\n{\n \"bel√∏pPerDag\": \"int\",\n \"fraOgMed\": \"date\",\n \"tilOgMed\": \"date\",\n \"st√∏nadsdata\": {\n    \"st√∏nadstype\": \"enum\",\n    <ekstra felter spesifikke for ytelsen>\n }\n}\nUtbetalingene m√• alts√• periodiseres og klienten m√• fastsette et bel√∏p per dag for perioden. Dersom bel√∏pet eller st√∏nadstypen\nendrer seg eller brukeren har dager i perioden uten utbetaling (eksempelvis helg), m√• det opprettes ny periode.Eksempler\nEksempel 1: Endring i bel√∏p\nBruker skal ha utbetaling mandag-fredag med 500kr/dag tom onsdag og 400kr/dag fom torsdag. Det representeres med f√∏lgende utbetalingsperioder:\n[\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2023-11-13\",\n    \"tilOgMed\": \"2023-11-15\"\n  },\n  {\n    \"bel√∏pPerDag\": 400,\n    \"fraOgMed\": \"2023-11-16\",\n    \"tilOgMed\": \"2023-11-17\"\n  }\n]\nEksempel 2: Utbetaling med samme bel√∏p for en 14-dagers periode\nBruker skal ha 500kr/dag for 14 dager, med unntak av helger. Det representeres med f√∏lgende utbetalingsperioder:\n[\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2023-11-13\",\n    \"tilOgMed\": \"2023-11-17\"\n  },\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2023-11-20\",\n    \"tilOgMed\": \"2023-11-24\"\n  }\n]\nMerk at dp-iverksett m√• ha bel√∏p per dag for meldepliktsytelser uavhengig av hvordan vedtaksl√∏sningen representerer utbetalingene\ninternt. Dette kommer av f√∏ringer fra NAVs √∏konomisystem. Dersom din vedtaksl√∏sning feks. representerer utbetalingen som et\ntotalbel√∏p for en 14-dagers periode, m√• dere p√• konsumentsiden fordele dette totalbel√∏pet p√• dagsbel√∏p slik dere ser det hensiktsmessig.","gjeldende-totalbilde-av-utbetalinger-p√•-saken#Gjeldende totalbilde av utbetalinger p√• saken":"Listen av utbetalinger som dp-iverksett tar i mot skal v√¶re det gjeldende totalbildet av utbetalinger for hele saken. dp-iverksett h√•ndterer utbetalingene\np√• samme m√•te uavhengig av om vedtaket som iverksettes er en f√∏rstegangsutbetaling eller en korrigering: N√•r dp-iverksett beregner hva som skal sendes\ntil utbetalingssystemet, regner den ut forskjellen p√• totalbildet for det nye vedtaket og totalbildet for det evt. forrige vedtaket som ble iverksatt.Konseptet er illustrert i figuren under for 3 meldekort, der ett meldekort korrigeres:\n(√Öpne bildet i ny fane for bedre oppl√∏sning - m√• pr√∏ve √• fikse dette)\nI denne figuren er D en dag med utbetaling og H er en helgedag uten utbetaling. Rosa farge indikerer en dag med korrigert utbetaling.Under er et eksempel p√• hvordan dataen for dette totalbildet kan se ut for 7 meldekort som sendes inn og korrigeres:\n(√Öpne bildet i ny fane for bedre oppl√∏sning - m√• pr√∏ve √• fikse dette)I det f√∏rste meldekortet som sendes inn (B-2) er det gjeldende totalbildet utbetaling for uke 1 og 2. For det neste meldekortet som sendes inn (B-3)\ner det gjeldende totalbildet utbetaling for uke 1 og 2 og uke 3 og 4. Dersom vedtaksl√∏sningen vil iverksette en korrigering av utbetalingen for uke 1 og 2 (B-4),\nsender den inn den nye sannheten for uke 1 og 2 og uendret utbetaling for uke 3 og 4. Her er det tre ting √• merke seg:\nVed en korrigering skal dp-iverksett alltid ha ny gjeldende sannhet, ikke differansen mellom ny og forrige utbetaling.\ndp-iverksett vil ikke agere p√• noe dersom totalbildet er uendret. Hvis totalbildet for deler av utbetalingen er uendret, som uke 3 og 4 over,\nvil det ikke skje noe med denne perioden. Hvis totalbildet for hele saken er uendret, vil ikke dp-iverksett sende noe til utbetalingssystemet.\nDersom det har v√¶rt utbetaling p√• saken tidligere, m√• dp-iverksett ha behandlingsid for den forrige behandlingen som ble iverksatt. Behandlingsid-en brukes til √• hente ut\ndet forrige totalbildet av utbetalinger p√• saken, slik at dp-iverksett kan utlede om den nye behandlingen er utbetaling for en ny periode eller om det er en korrigering\n(og i s√• fall hva som skal korrigeres).\nMerk ogs√• at korrigeringen av utbetalingen for uke 5-6 (B-6) er et opph√∏r. Ved opph√∏r av utbetaling forventer dp-iverksett at det ikke finnes noen utbetalinger\nfor perioden opph√∏ret gjelder for. I dette eksempelet er alts√• alle utbetalingene for uke 5-6 fjernet fra listen. Dersom man vil iverksette et opph√∏r av alle utbetalinger p√• saken,\nkan man sende en tom liste av utbetalinger til dp-iverksett.","periodisering-av-utbetalinger#Periodisering av utbetalinger":"Utbetalingsperiodene som sendes til utbetalingstjenesten vil bli sendt videre til √òkonomisystemet med samme periodisering som utbetalingstjenesten mottar. √òkonomisystemet/PO Utbetaling\nhar et √∏nske om √• minimere antall identiske utbetalingsperioder som sendes. Dette illustreres best ved et eksempel. Dersom man vil iverksette en utbetaling for mandag-fredag med likt dagsbel√∏p og st√∏nadstype,\ner det bedre √• sende dette som √©n periode:\n[\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-12\",\n    \"tilOgMed\": \"2024-02-16\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  }\n]\nHeller enn √• sende 5 identiske perioder:\n[\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-12\",\n    \"tilOgMed\": \"2024-02-12\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  },\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-13\",\n    \"tilOgMed\": \"2024-02-13\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  },\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-14\",\n    \"tilOgMed\": \"2024-02-14\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  },\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-15\",\n    \"tilOgMed\": \"2024-02-15\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  },\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-16\",\n    \"tilOgMed\": \"2024-02-16\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  }\n]\nUtbetalingsperioder som sendes p√• tvers av behandlinger m√• imidlertid deles opp selv om de er like og ligger back-to-back i tid. Eksempelvis:Dersom man i behandling #1 iverksetter f√∏lgende utbetalingsperiode:\n[\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-12\",\n    \"tilOgMed\": \"2024-02-16\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  }\n]\nOg man i behandling #2 vil iverksette flere dager med utbetaling, m√• dette deles i to:\n[\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-12\",\n    \"tilOgMed\": \"2024-02-16\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  },\n  {\n    \"bel√∏pPerDag\": 500,\n    \"fraOgMed\": \"2024-02-17\",\n    \"tilOgMed\": \"2024-02-23\",\n    \"st√∏nadsdata\": {\n      \"st√∏nadstype\": \"DAGPENGER_ARBEIDSS√òKER_ORDIN√ÜR\"\n    }\n  }\n]\nDersom disse utbetalingene hadde blitt sl√•tt sammen til √©n periode, vil vi ikke klare √• utlede hva som er differansen fra totalbildet i forrige utbetaling.","tilgangskontroll-og-validering-av-vedtak#Tilgangskontroll og validering av vedtak":"Funksjonaliteten som tilbys i dp-iverksett er direkte koblet til penger som betales ut fra NAV til sluttbruker. Det kan ha store konsekvenser\ndersom vi betaler ut for mye penger eller penger til feil person. Derfor er vi n√∏dt til √• ha streng tilgangskontroll p√• vedtakene som dp-iverksett\ntar i mot.Meldepliktsytelsene har gjerne en todelt flyt der det f√∏rst fattes et vedtak om rett til ytelsen, og s√• danner meldekortene brukeren sender inn\ngrunnlaget for hva som skal utbetales i en gitt periode. Meldekortene behandles stort sett fullautomatisk av vedtaksl√∏sningen, mens vedtaket om\nrett kan behandles helt eller delvis manuelt.Dp-iverksett krever at konsumentene sender b√•de vedtaket om rett og vedtakene for utbetaling som f√∏lger av meldekortene med riktig kontekst. Tjenesten vil validere\nat vedtak med saksbehandler-kontekst kommer fra en ansatt med beslutter-rolle for ytelsen. Videre har dp-iverksett oversikt over hvilken klient-applikasjon som\nhar tilgang til √• gj√∏re kall med ren system-kontekst for hver ytelse.Dersom dp-iverksett mottar en utbetaling som ikke kan spores tilbake til et vedtak om rett til ytelsen eller mottar en utbetaling fra en applikasjon\nsom ikke har tilgang til √• gj√∏re kall med system-kontekst, vil utbetalingen avvises.For vedtaket om rett til ytelsen trenger dp-iverksett √• vite saksid, behandlingsid og sluttbrukeren vedtaket gjelder. Disse vedtakene kan sendes\ntil det samme endepunktet som utbetalingene sendes til. I kontraktene finnes det en default-verdi for vedtaksdetaljer for slike vedtak. Informasjonen\ndp-iverksett krever er eksemplifisert under:\n{\n  \"sakId\": \"ec45be1c-1f2d-451e-bea3-e5a240586287\",\n  \"behandlingId\": \"f28417ba-78bb-440b-985c-fc1f0330c1c2\",\n  \"personIdent\": \"<fnr>\",\n  \"vedtak\": {\n    \"vedtakstidspunkt\": \"2023-06-19T15:24:14\",\n    \"saksbehandlerId\": \"S123456\",\n    \"beslutterId\": \"B123456\",\n    \"utbetalinger\": []\n  }\n}\nMerk at vi ikke gj√∏r noen validering p√• feltene saksbehandlerId og beslutterId. Vi sjekker ikke at de er gyldige NAV-identer, og vi sjekker ikke at OBO-tokenet p√• kallet h√∏rer til samme ident\nsom identen i beslutterId-feltet."}},"/for_konsumenter/status":{"title":"Status p√• utbetaling","data":{"":"Status p√• utbetalinger er en av f√∏lgende verdier:\nStatus\tBeskrivelse\tIKKE_P√ÖBEGYNT\tIkke sendt til √∏konomisystemet\tSENDT_TIL_OPPDRAG\tSendt til √∏konomisystemet, venter p√• svar\tFEILET_MOT_OPPDRAG\tFeilkvittering fra √∏konomisystemet. Kan v√¶re enten teknisk eller funksjonell feil.\tOK\tKvittert OK fra √∏konomisystemet og ferdigstilt.\tOK_UTEN_UTBETALING\tFerdigstilt uten √• ha blitt sendt til √∏konomisystemet pga. at det ikke er noe √• utbetale","med-rest#Med REST":"","get-behandlingidstatus#GET /{behandlingId}/status":"Henter status p√• utbetaling. Dette endepunktet kan brukes for √• sjekke tilstanden til en utbetaling som er tatt i mot og\nvalidert av dp-iverksett. NAVs √∏konomisystem har en asynkron integrasjon og er i tillegg et stormaskinsystem som har definerte\noppetider. √òkonomisystemet er vanligvis stengt i helger, helligdager og mellom kl 21 og kl 6 p√• virkedager. Derfor kan det\nta lang tid f√∏r en utbetaling blir kvittert ut fra √∏konomisystemet avhengig av n√•r den er sendt inn.Dersom dp-iverksett finner behandlingen, vil endepunktet svare med 200 OK og utbetalingsstatus.","med-kafka#Med Kafka":"Vi har satt opp en topic hvor vi tilbyr statusendringer p√• utbetalinger: teamdagpenger.iverksetting-status-v1. Om dette\ner interessant for dere kan dere kontakte oss s√• vi f√•r gitt appen deres tilgang til topicen. I tillegg m√• f√∏lgende finnes\ni nais-konfigen deres:\nspec:\n  kafka:\n    pool: nav-prod # Eller nav-dev for dev-milj√∏\nMeldinger som publiseres her bruker personident som n√∏kkel og har f√∏lgende format p√• meldingen:\ndata class StatusEndretMelding(\n    val sakId: String,\n    val behandlingId: String,\n    val iverksettingId: String?,\n    val fagsystem: Fagsystem,\n    val status: IverksettStatus,\n)\nDataklassen finner du i dp-kontrakter om du √∏nsker √• bruke den direkte."}},"/":{"title":"Om tjenesten","data":{"":"NB! Denne dokumentasjonssiden er under aktiv utvikling. Beklager for evt. skrivefeil, uklarheter, lange tekster og mangel p√• tekst üòä Vi tar gjerne i mot tilbakemeldinger ‚Äì innspill og √∏nsker kan sendes p√• slack.","dp-iverksett#DP-Iverksett":"Dp-iverksett tilbyr tjenester innenfor utbetalingsdomenet for arbeidsytelser. Mer spesifikt kan den sende og korrigere utbetalinger, avstemme utbetalinger og gi oppdatert status p√• tilstanden til en utbetaling.\nSe individuelle sider for dokumentasjon av hver tjeneste.Hensikten med denne siden er √• dokumentere konsepter og funksjonelle aspekter ved dp-iverksett sine tjenester som ikke kommer tydelig frem i API-dokumentasjonen. Er du ute etter tekniske detaljer rundt endepunktene, se Swagger-dokumentasjonen\nher. Videre finnes det kontrakter for alle DTO-er som dp-iverksett bruker i sitt API her.\nDe aktuelle kontraktene for iverksetting ligger i artifaktet iverksett. Vi oppfordrer alle konsumenter til √• ta i bruk kontraktene.","intern-arkitektur#Intern arkitektur":""}},"/utvikling":{"title":"Utvikling","data":{}}}